{
  "kind": "build_request",
  "title": "Implement vehicle location update function and enhance train schedule",
  "projectName": "My Belgavi",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-38",
      "text": "Add a backend update function addOrUpdateVehicleLocation that accepts vehicle ID, latitude, longitude, and timestamp to enable real-time GPS location updates for vehicles",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-user-addOrUpdateVehicleLocation",
          "msg-assistant-explanation",
          "msg-user-yes-train-schedule"
        ],
        "quotes": [
          "addOrUpdateVehicleLocation",
          "Add a backend update function (addOrUpdateVehicleLocation) that accepts vehicle ID, coordinates, and timestamp"
        ]
      },
      "acceptanceCriteria": [
        "Backend function addOrUpdateVehicleLocation exists and accepts vehicleId (Text), latitude (Float), longitude (Float), and timestamp (Int) parameters",
        "Function updates existing vehicle location if vehicle ID exists, or creates new vehicle record if it doesn't exist",
        "Updated location data is immediately available via getVehicleLocations query",
        "Function handles invalid coordinates and missing vehicle IDs gracefully with appropriate error messages"
      ]
    },
    {
      "id": "REQ-39",
      "text": "Connect the frontend to call addOrUpdateVehicleLocation backend function and enable periodic vehicle location updates to show movement on the transport map",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-assistant-explanation",
          "msg-user-yes-train-schedule"
        ],
        "quotes": [
          "Wire the frontend to poll for updates every few seconds to show movement"
        ]
      },
      "acceptanceCriteria": [
        "Frontend useQueries.ts includes a mutation hook for addOrUpdateVehicleLocation",
        "TransportMap component can trigger location updates for test vehicles",
        "Vehicle markers on the map update smoothly when new location data arrives",
        "Location update errors are handled and logged appropriately"
      ]
    },
    {
      "id": "REQ-40",
      "text": "Enhance the train schedule display on the transport page with comprehensive schedule information, improved visual layout, and better filtering capabilities",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-yes-train-schedule"
        ],
        "quotes": [
          "make train schedule"
        ]
      },
      "acceptanceCriteria": [
        "Train schedule display shows detailed timing and route information in an organized table format",
        "Users can filter trains by station, destination, or route",
        "Schedule information includes departure times, arrival times, train numbers, and intermediate stations",
        "Layout is responsive and works well on mobile and desktop devices",
        "Visual design is consistent with the app's warm orange/amber theme"
      ]
    }
  ],
  "constraints": [
    "Maintain single-actor architecture in backend/main.mo",
    "Do not modify immutable frontend paths (useInternetIdentity.ts, useInternetIdentity.tsx, useActor.ts, main.tsx, components/ui)",
    "Preserve existing vehicle tracking polling interval of 5 seconds configured in useQueries.ts",
    "Keep Google Maps integration in TransportMap.tsx intact while adding vehicle update functionality"
  ],
  "nonGoals": [
    "Integrating with actual external GPS tracking services or vehicle hardware",
    "Building a separate GPS tracking backend service or microservice",
    "Adding real-time WebSocket connections for vehicle updates",
    "Implementing train schedule API integration with Indian Railways",
    "Creating a separate admin interface for managing train schedules"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}